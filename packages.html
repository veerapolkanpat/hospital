<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>แพ็กเกจบริการ – โรงพยาบาลวีระพลการแพทย์</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Google Font: Prompt -->
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-QZ0FG8PVXQ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-QZ0FG8PVXQ');
</script>

  <style>
    body{
      font-family:'Prompt',sans-serif;
      background-color:#f8f9fa;
    }
    .section-top{ padding-top: 90px; }
    @media (max-width:768px){ .section-top{ padding-top:120px; } }

    .filter-card{
      background:#fff; border:1px solid #e9ecef; border-radius:14px;
      box-shadow:0 8px 24px rgba(0,0,0,.06);
    }
    .card-package{
      border:1px solid #eef2f6; border-radius:14px; height:100%;
      transition:transform .2s ease, box-shadow .2s ease, border-color .2s ease;
    }
    .card-package:hover{
      transform:translateY(-3px);
      box-shadow:0 12px 28px rgba(0,0,0,.08);
      border-color:#dfe8f7;
    }
    .card-package .badge{
      background:#e9f2ff; color:#0d6efd; border:1px solid #d9e8ff;
    }
    .price{ color:#0b5ed7; font-weight:700; font-size:1.15rem; }
    .old-price{ text-decoration:line-through; color:#6c757d; font-size:.95rem; }
    .list-mini{ margin:0; padding-left:1.2rem; color:#334155; }
    .list-mini li{ margin-bottom:.25rem; }
  </style>
</head>
<body>

<!-- ✅ Navbar (เหมือน room.html) -->
<header class="bg-white shadow-sm fixed-top">
  <nav class="navbar navbar-expand-md navbar-light bg-white container">
    <a class="navbar-brand d-flex align-items-center" href="https://veerapolkanpat.github.io/hospital/">
      <img src="https://raw.githubusercontent.com/veerapolkanpat/hospital/main/LOGO.png" alt="Logo" class="rounded-circle me-2" style="height:48px;width:48px;">
      <span class="fw-bold text-success">รพ.วีระพลการแพทย์</span>
    </a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNavbar">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="mainNavbar">
      <ul class="navbar-nav ms-auto mb-2 mb-md-0">
        <li class="nav-item"><a class="nav-link" href="https://veerapolkanpat.github.io/hospital/">หน้าแรก</a></li>
        <li class="nav-item"><a class="nav-link" href="https://veerapolkanpat.github.io/hospital/#about">เกี่ยวกับเรา</a></li>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="https://veerapolkanpat.github.io/hospital/#services" role="button" data-bs-toggle="dropdown">บริการ</a>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="/hospital/room.html">ห้องพักและสิ่งอำนวยความสะดวก</a></li>
            <li><a class="dropdown-item" href="/hospital/insurance.html">บริษัทประกันคู่สัญญา</a></li>
            <li><a class="dropdown-item active" aria-current="page" href="/hospital/packages.html">แพ็กเกจบริการ</a></li>
          </ul>
        </li>
        <li class="nav-item"><a class="nav-link" href="https://veerapolkanpat.github.io/hospital/#doctors">แพทย์ของเรา</a></li>
        <li class="nav-item"><a class="nav-link" href="https://veerapolkanpat.github.io/appointment-form/" target="_blank">นัดหมาย</a></li>
        <li class="nav-item"><a class="nav-link" href="https://veerapolkanpat.github.io/hospital/#contact">ติดต่อเรา</a></li>
      </ul>
    </div>
  </nav>
</header>

<!-- ✅ Content -->
<div class="container section-top">
  <h2 class="text-center text-primary fw-bold mb-2">แพ็กเกจบริการและตรวจสุขภาพ</h2>
  <p class="text-center text-muted mb-4">
    คัดสรรแพ็กเกจยอดนิยม ครอบคลุมทั้งตรวจสุขภาพ วัคซีน ทันตกรรม คลอดบุตร หัตถการ ตา/ENT กายภาพบำบัด และเหมาจ่ายห้องพัก
  </p>

  <!-- ฟิลเตอร์/ค้นหา -->
  <div class="filter-card p-3 p-md-4 mb-4">
    <div class="row g-2 align-items-center">
      <div class="col-12 col-md-5">
        <input id="searchInput" type="text" class="form-control" placeholder="ค้นหา: ชื่อแพ็กเกจ / คำสำคัญ เช่น 'เบาหวาน', 'วัคซีน'">
      </div>
      <div class="col-6 col-md-3">
        <select id="categorySelect" class="form-select">
          <option value="ALL">ทุกหมวดหมู่</option>
          <option value="ตรวจสุขภาพ">ตรวจสุขภาพ</option>
          <option value="วัคซีน">วัคซีน</option>
          <option value="ทันตกรรม">ทันตกรรม</option>
          <option value="คลอดบุตร">คลอดบุตร</option>
          <option value="ศัลยกรรม/หัตถการ">ศัลยกรรม/หัตถการ</option>
          <option value="ตา/ENT">ตา/ENT</option>
          <option value="กายภาพบำบัด">กายภาพบำบัด</option>
          <option value="ห้องพัก/เหมาจ่าย">ห้องพัก/เหมาจ่าย</option>
          <option value="โปรโมชัน">โปรโมชัน</option>
        </select>
      </div>
      <div class="col-6 col-md-2">
        <select id="sortSelect" class="form-select">
          <option value="default">จัดเรียง</option>
          <option value="price-asc">ราคาต่ำ → สูง</option>
          <option value="price-desc">ราคาสูง → ต่ำ</option>
        </select>
      </div>
      <div class="col-12 col-md-2 text-md-end">
        <a href="https://veerapolkanpat.github.io/appointment-form/" target="_blank" class="btn btn-primary w-100">
          นัดหมายแพทย์
        </a>
      </div>
    </div>
  </div>

  <!-- กริดแพ็กเกจ -->
  <div id="grid" class="row g-4">
    <!-- cards injected by JS -->
  </div>
</div>

<!-- Modal รายละเอียด -->
<div class="modal fade" id="detailModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header" style="background:#f3f7ff;">
        <h5 id="modalTitle" class="modal-title fw-bold"></h5>
        <button class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="row g-3">
          <div class="col-md-5">
            <img id="modalImg" src="" alt="" class="img-fluid rounded border">
            <div class="mt-2">
              <span id="modalCategory" class="badge"></span>
            </div>
          </div>
          <div class="col-md-7">
            <div class="mb-2">
              <span id="modalPrice" class="price"></span>
              <span id="modalOldPrice" class="old-price ms-2"></span>
            </div>
            <div id="modalDesc" class="mb-3 text-secondary"></div>
            <div>
              <h6 class="fw-semibold">รายการครอบคลุม</h6>
              <ul id="modalIncludes" class="list-mini"></ul>
            </div>
            <div class="mt-3">
              <small id="modalNote" class="text-muted"></small>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer bg-light">
        <a id="modalBook" href="https://veerapolkanpat.github.io/appointment-form/" target="_blank" class="btn btn-primary">นัดหมายแพทย์</a>
        <a href="https://veerapolkanpat.github.io/hospital/#contact" class="btn btn-outline-secondary">สอบถามเพิ่มเติม</a>
      </div>
    </div>
  </div>
</div>

<!-- Bootstrap Bundle -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
  // ====== GLOBAL STATE ======
  let PACKAGES = []; // จะถูกโหลดจาก packages.json
  const grid = document.getElementById('grid');
  const searchInput = document.getElementById('searchInput');
  const categorySelect = document.getElementById('categorySelect');
  const sortSelect = document.getElementById('sortSelect');
  const modal = new bootstrap.Modal('#detailModal');
  const fmt = v => new Intl.NumberFormat('th-TH',{style:'currency',currency:'THB',maximumFractionDigits:0}).format(v);

  // ====== LOAD JSON ======
  async function loadPackages(){
    try{
      // ใช้ path แบบ absolute ให้ชัดเจนใน GitHub Pages
      const res = await fetch('/hospital/packages.json', { cache: 'no-cache' });
      const j = await res.json();
      PACKAGES = Array.isArray(j) ? j : (j?.data || []);
      applyFilter();
    }catch(err){
      grid.innerHTML = `
        <div class="col-12">
          <div class="alert alert-danger">โหลดข้อมูลไม่สำเร็จ: ${err.message}</div>
        </div>`;
    }
  }

  // ====== RENDER ======
  function openDetail(id){
    const p = PACKAGES.find(x=>x.id===id);
    if(!p) return;
    document.getElementById('modalTitle').textContent = p.title;
    document.getElementById('modalImg').src = p.img;
    document.getElementById('modalCategory').textContent = p.category;
    document.getElementById('modalPrice').textContent = fmt(p.price);
    const old = document.getElementById('modalOldPrice');
    if(p.oldPrice==null){ old.textContent=''; old.classList.add('d-none'); } else { old.textContent=fmt(p.oldPrice); old.classList.remove('d-none'); }
    document.getElementById('modalDesc').textContent = p.short || '';
    document.getElementById('modalIncludes').innerHTML = (p.includes||[]).map(i=>`<li>${i}</li>`).join('');
    document.getElementById('modalNote').textContent = p.note || '';
    document.getElementById('modalBook').href = 'https://veerapolkanpat.github.io/appointment-form/';
    modal.show();
  }

  function render(list){
    grid.innerHTML = '';
    if(list.length===0){
      grid.innerHTML = `
        <div class="col-12">
          <div class="alert alert-light border text-center">ไม่พบแพ็กเกจที่ตรงกับเงื่อนไข</div>
        </div>`;
      return;
    }
    list.forEach(p=>{
      const col = document.createElement('div');
      col.className = 'col-12 col-md-6 col-lg-4';
      col.innerHTML = `
        <div class="card card-package">
          <img src="${p.img}" class="card-img-top" alt="${p.title}">
          <div class="card-body d-flex flex-column">
            <div class="d-flex align-items-center justify-content-between mb-2">
              <span class="badge">${p.category}</span>
              <div class="text-end">
                <span class="price">${fmt(p.price)}</span>
                ${p.oldPrice!=null?`<span class="old-price ms-1">${fmt(p.oldPrice)}</span>`:''}
              </div>
            </div>
            <h5 class="card-title mb-1">${p.title}</h5>
            <p class="text-secondary small mb-3">${p.short||''}</p>
            <ul class="list-mini small mb-3">
              ${(p.includes||[]).slice(0,3).map(i=>`<li>${i}</li>`).join('')}
              ${(p.includes||[]).length>3?'<li>…</li>':''}
            </ul>
            <div class="mt-auto d-grid gap-2">
              <button class="btn btn-outline-primary" data-id="${p.id}" data-role="detail">ดูรายละเอียด</button>
              <a class="btn btn-primary" href="https://veerapolkanpat.github.io/appointment-form/" target="_blank">นัดหมาย</a>
            </div>
          </div>
        </div>`;
      grid.appendChild(col);
    });
    grid.querySelectorAll('button[data-role="detail"]').forEach(b=>{
      b.addEventListener('click', e=>openDetail(e.currentTarget.getAttribute('data-id')));
    });
  }

  function applyFilter(){
    const q = (searchInput.value||'').trim().toLowerCase();
    const cat = categorySelect.value;
    let filtered = PACKAGES.filter(p=>{
      if(p.active === false) return false;
      const txt = [p.title,p.category,p.short,...(p.includes||[])].join(' ').toLowerCase();
      const matchQ = q? txt.includes(q): true;
      const matchCat = (cat==='ALL')? true : p.category===cat;
      return matchQ && matchCat;
    });
    const sort = sortSelect.value;
    if(sort==='price-asc') filtered.sort((a,b)=>a.price-b.price);
    if(sort==='price-desc') filtered.sort((a,b)=>b.price-a.price);
    render(filtered);
  }

  // events
  searchInput.addEventListener('input', applyFilter);
  categorySelect.addEventListener('change', applyFilter);
  sortSelect.addEventListener('change', applyFilter);

  // init
  loadPackages();
</script>

</body>
</html>
